manage_etc_hosts: true

users:
  - name: dev
    gecos: "Dev User"
    groups: [wheel]
    sudo: ["ALL=(ALL) NOPASSWD:ALL"]
    shell: /bin/bash
    lock_passwd: false
  - name: rocky
    gecos: "Rocky User"
    groups: [wheel]
    sudo: ["ALL=(ALL) NOPASSWD:ALL"]
    shell: /bin/bash
    lock_passwd: false

ssh_pwauth: true

chpasswd:
  expire: false
  list: |
    dev:dev1234!
    rocky:rocky1234

# SSH 키 설정 (Vault에서 가져온 키)
ssh_authorized_keys:
  - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC7Kib4hg+iFUoAumLp2ZYRBdBN7TBMSP9xjS67DhLlwAn+/60Ie9Hu72pMEGG968vvQfTxULfq7i+k44BIqWwwZ3HiOl/li9t/Kjx3X70wN2Te6ivGkzXu62bJpjM3nY4jfdOptYhAWYw2Gd2sd25Npj9BQcr7/f7eKfx1ImD0DxnsgVrDE2OCS5l48oZlvSlP5cwadScW1j9ocpLI9ikmsQpO0kmYFMG3iceVoOEsd4F/NEwGIRKBg3kYJDKpJYc5gD9K5pLaEjqXzp8mgQyfiwYMcaoKAJAB4vUij43latYGWV1MWjP+OIJhnEz7EOxAed0x6gcyOvEF2/kU7vYPLW5EMh9HHoCq8csf81+z/btWYouopc3aBJXgWluHNbLYuwfwPhUwSm8SDHlDvUjOxACbM/PXm/t3GV8dzLaYN3gYwgGj35ftTdcXJGy/qUkOjplxNuhAnD5QSdJRO4NoI4/a8UiyeWuP6Tpj/ETt7R3QAds0tZ9YzANLM22UxuNorbiQ883HtKcgAovmcBb4riznJdqMraIasmsNEnY0TVWdFKk6ps+cCJs7uYDVwr5j7O4ViA96FLNEmP6Fg5m1e/ktEt62rrVunFdjxb950Sru+mj4xEhFfJ10InZl/qAKy54/7wPiJt0a1vOQMfnkyPKN6fWVbc/kCuL31kqINw== dmc_dev@test2

# 시스템 타임존을 KST로 고정
timezone: Asia/Seoul

# NTP 동기화 (chrony 사용 권장)
ntp:
  enabled: true
  ntp_client: chrony
  servers:
    - time.kriss.re.kr
    - time.bora.net
    - 0.kr.pool.ntp.org
    - 1.kr.pool.ntp.org

# SELinux/Firewalld 비활성화 및 시간/서비스 보정
runcmd:
  # SELinux 비활성화 (영구/즉시)
  - [ bash, -lc, "sed -ri 's/^SELINUX=.*/SELINUX=disabled/' /etc/selinux/config || true" ]
  - [ bash, -lc, "setenforce 0 || true" ]

  # firewalld 중지/비활성화 (이미지에 있을 경우)
  - [ bash, -lc, "systemctl disable --now firewalld || true" ]

  # chrony 보강 설정(있으면 유지, 없으면 설치)
  - [ bash, -lc, "rpm -q chrony >/dev/null 2>&1 || (dnf -y install chrony || yum -y install chrony)" ]
  - [ bash, -lc, "systemctl enable --now chronyd" ]

  # 타임존 재확인
  - [ bash, -lc, "timedatectl set-timezone Asia/Seoul" ]

final_message: "Cloud-init: dev/rocky 계정/SSH PW/SELinux off/firewalld off/KST/NTP 설정 완료"
